<?xml version="1.0" encoding="utf-8"?>
<!--
This file is part of "Playful Sparkle - Google reCAPTCHA" project and subject to the terms
and conditions defined in file "LICENSE", which is part of this source
code package and also available on the project page: https://github.com/playfulsparkle/oc3_google_recaptcha.git
-->
<modification>
    <name>Playful Sparkle - Google reCAPTCHA</name>
    <code>ps_google_recaptcha</code>
    <version>1.0.0</version>
    <author>Playful Sparkle</author>
    <link>https://github.com/playfulsparkle/oc3_google_recaptcha.git</link>
    <!-- frontend start -->
    <file path="catalog/view/theme/default/template/common/header.twig">
        <operation>
            <search><![CDATA[</head>]]></search>
            <add position="before"><![CDATA[<link rel="preconnect" href="https://www.google.com">
            <link rel="preconnect" href="https://www.gstatic.com" crossorigin>]]></add>
        </operation>
    </file>
    <!-- frontend end -->
    <!-- register start -->
    <file path="catalog/controller/account/register.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('account/register', $data));]]></search>
            <add position="before"><![CDATA[
        if (
            $this->config->get('captcha_ps_google_recaptcha_status') &&
            ($this->config->get('captcha_ps_google_recaptcha_key_type') !== 'v3' ||
            $this->config->get('captcha_ps_google_recaptcha_key_type') !== 'v2_invisible')
        ) {
            if (!isset($this->session->data['ps_google_recaptcha_counter'])) {
                $this->session->data['ps_google_recaptcha_counter'] = 0;
            } else {
                $this->session->data['ps_google_recaptcha_counter']++;
            }

            $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];
            $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
            $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
            $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
            $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
            $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
        }
            ]]></add>
        </operation>
    </file>
    <file path="catalog/view/theme/default/template/account/register.twig">
        <operation>
            <search position="replace"><![CDATA[<input type="submit" value="{{ button_continue }}" class="btn btn-primary" />]]></search>
            <add><![CDATA[{% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %}
                <input type="submit" value="{{ button_continue }}" class="btn btn-primary g-recaptcha" data-sitekey="{{ ps_site_key }}" data-theme="{{ ps_badge_theme }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-badge="{{ ps_badge_position }}"{% if ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %} data-action="submit" />
            {% else %}
                <input type="submit" value="{{ button_continue }}" class="btn btn-primary" />
            {% endif %}]]></add>
        </operation>
    </file>
    <!-- register end -->
    <!-- return start -->
    <file path="catalog/controller/account/return.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('account/return_form', $data));]]></search>
            <add position="before"><![CDATA[
        if (
            $this->config->get('captcha_ps_google_recaptcha_status') &&
            ($this->config->get('captcha_ps_google_recaptcha_key_type') !== 'v3' ||
            $this->config->get('captcha_ps_google_recaptcha_key_type') !== 'v2_invisible')
        ) {
            if (!isset($this->session->data['ps_google_recaptcha_counter'])) {
                $this->session->data['ps_google_recaptcha_counter'] = 0;
            } else {
                $this->session->data['ps_google_recaptcha_counter']++;
            }

            $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];
            $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
            $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
            $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
            $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
            $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
        }
            ]]></add>
        </operation>
    </file>
    <file path="catalog/view/theme/default/template/account/return_form.twig">
        <operation>
            <search position="replace"><![CDATA[<input type="submit" value="{{ button_submit }}" class="btn btn-primary" />]]></search>
            <add><![CDATA[{% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %}
                <input type="submit" value="{{ button_submit }}" class="btn btn-primary g-recaptcha" data-sitekey="{{ ps_site_key }}" data-theme="{{ ps_badge_theme }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-badge="{{ ps_badge_position }}"{% if ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %} data-action="submit" />
            {% else %}
                <input type="submit" value="{{ button_submit }}" class="btn btn-primary" />
            {% endif %}]]></add>
        </operation>
    </file>
    <!-- return end -->
    <!-- contact start -->
    <file path="catalog/controller/information/contact.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('information/contact', $data));]]></search>
            <add position="before"><![CDATA[
        if (
            $this->config->get('captcha_ps_google_recaptcha_status') &&
            ($this->config->get('captcha_ps_google_recaptcha_key_type') !== 'v3' ||
            $this->config->get('captcha_ps_google_recaptcha_key_type') !== 'v2_invisible')
        ) {
            if (!isset($this->session->data['ps_google_recaptcha_counter'])) {
                $this->session->data['ps_google_recaptcha_counter'] = 0;
            } else {
                $this->session->data['ps_google_recaptcha_counter']++;
            }

            $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];
            $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
            $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
            $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
            $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
            $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
        }
            ]]></add>
        </operation>
    </file>
    <file path="catalog/view/theme/default/template/information/contact.twig">
        <operation>
            <search position="replace"><![CDATA[<input class="btn btn-primary" type="submit" value="{{ button_submit }}" />]]></search>
            <add><![CDATA[{% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %}
                <input class="btn btn-primary g-recaptcha" data-sitekey="{{ ps_site_key }}" data-theme="{{ ps_badge_theme }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-badge="{{ ps_badge_position }}"{% if ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %} data-action="submit" type="submit" value="{{ button_submit }}" />
            {% else %}
                <input class="btn btn-primary" type="submit" value="{{ button_submit }}" />
            {% endif %}]]></add>
        </operation>
    </file>
    <!-- contact end -->
    <!-- product review start -->
    <file path="catalog/controller/product/product.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('product/product', $data));]]></search>
            <add position="before"><![CDATA[
        if (
            $this->config->get('captcha_ps_google_recaptcha_status') &&
            ($this->config->get('captcha_ps_google_recaptcha_key_type') !== 'v3' ||
            $this->config->get('captcha_ps_google_recaptcha_key_type') !== 'v2_invisible')
        ) {
            if (!isset($this->session->data['ps_google_recaptcha_counter'])) {
                $this->session->data['ps_google_recaptcha_counter'] = 0;
            } else {
                $this->session->data['ps_google_recaptcha_counter']++;
            }

            $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];
            $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
            $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
            $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
            $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
            $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
        }
            ]]></add>
        </operation>
    </file>
    <file path="catalog/view/theme/default/template/product/product.twig">
        <operation>
            <search position="replace"><![CDATA[<button type="button" id="button-review" data-loading-text="{{ text_loading }}" class="btn btn-primary">{{ button_continue }}</button>]]></search>
            <add><![CDATA[{% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %}
                <button type="button" id="button-review" data-loading-text="{{ text_loading }}" class="btn btn-primary g-recaptcha" data-sitekey="{{ ps_site_key }}" data-theme="{{ ps_badge_theme }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-badge="{{ ps_badge_position }}"{% if ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %} data-action="submit">{{ button_continue }}</button>
            {% else %}
                <button type="button" id="button-review" data-loading-text="{{ text_loading }}" class="btn btn-primary">{{ button_continue }}</button>
            {% endif %}]]></add>
        </operation>
    </file>
    <!-- product review end -->
</modification>
