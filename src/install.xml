<?xml version="1.0" encoding="utf-8"?>
<!--
This file is part of "Playful Sparkle - Google reCAPTCHA" project and subject to the terms
and conditions defined in file "LICENSE", which is part of this source
code package and also available on the project page: https://github.com/playfulsparkle/oc3_google_recaptcha.git
-->
<modification>
    <name>Playful Sparkle - Google reCAPTCHA</name>
    <code>ps_google_recaptcha</code>
    <version>1.0.2</version>
    <author>Playful Sparkle</author>
    <link>https://github.com/playfulsparkle/oc3_google_recaptcha.git</link>

    <!-- admin forgotten password start -->
    <file path="admin/controller/common/forgotten.php">
    <operation>
        <search><![CDATA[protected function validate() {]]></search>
        <add position="after"><![CDATA[
        if (in_array('admin_forgotten_password', (array) $this->config->get('config_captcha_page'))) {
            $ps_captcha = $this->load->controller('extension/captcha/ps_google_recaptcha/validate_captcha');

            if ($ps_captcha) {
                unset($this->session->data['user_token']);

                $this->error['warning'] = $ps_captcha;

                return !$this->error;
            }
        }
        ]]></add>
    </operation>
    </file>

    <file path="admin/controller/common/forgotten.php">
    <operation>
        <search><![CDATA[$data['footer'] = ]]></search>
        <add position="after"><![CDATA[
        if (in_array('admin_forgotten_password', (array) $this->config->get('config_captcha_page'))) {
            $data['ps_captcha'] = $this->load->controller('extension/captcha/ps_google_recaptcha/render_captcha');
        } else {
            $data['ps_captcha'] = '';
        }

        $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

        if ($data['ps_google_recaptcha_status']) {
            $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

            $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
            $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
            $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
            $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
            $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
        }
        ]]></add>
    </operation>
    </file>

    <file path="admin/view/template/common/forgotten.twig">
    <operation>
        <search><![CDATA[<div class="text-right">]]></search>
        <add position="before"><![CDATA[{{ ps_captcha }}]]></add>
    </operation>
    </file>

    <file path="admin/view/template/common/forgotten.twig">
    <operation>
        <search position="replace"><![CDATA[<button type="submit" class="btn btn-primary"><i class="fa fa-check"></i> {{ button_reset }}</button>]]></search>
        <add><![CDATA[{% if ps_google_recaptcha_status %}
            <button type="submit" class="btn btn-primary g-recaptcha"
            {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
            {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
            {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %}><i class="fa fa-check"></i> {{ button_reset }}</button>
        {% else %}
            <button type="submit" class="btn btn-primary"><i class="fa fa-check"></i> {{ button_reset }}</button>
        {% endif %}]]></add>
    </operation>
    </file>
    <!-- admin forgotten password end -->

    <!-- admin login start -->
    <file path="admin/controller/common/login.php">
    <operation>
        <search><![CDATA[protected function validate() {]]></search>
        <add position="after"><![CDATA[
        if (in_array('admin_login', (array) $this->config->get('config_captcha_page'))) {
            $ps_captcha = $this->load->controller('extension/captcha/ps_google_recaptcha/validate_captcha');

            if ($ps_captcha) {
                unset($this->session->data['user_token']);

                $this->error['warning'] = $ps_captcha;

                return !$this->error;
            }
        }
        ]]></add>
    </operation>
    </file>

    <file path="admin/controller/common/login.php">
    <operation>
        <search><![CDATA[$data['footer'] = ]]></search>
        <add position="after"><![CDATA[
        if (in_array('admin_login', (array) $this->config->get('config_captcha_page'))) {
            $data['ps_captcha'] = $this->load->controller('extension/captcha/ps_google_recaptcha/render_captcha');
        } else {
            $data['ps_captcha'] = '';
        }

        $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

        if ($data['ps_google_recaptcha_status']) {
            $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

            $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
            $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
            $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
            $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
            $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
        }
        ]]></add>
    </operation>
    </file>

    <file path="admin/view/template/common/login.twig">
    <operation>
        <search><![CDATA[<div class="text-right">]]></search>
        <add position="before"><![CDATA[{{ ps_captcha }}]]></add>
    </operation>
    </file>

    <file path="admin/view/template/common/login.twig">
    <operation>
        <search position="replace"><![CDATA[<button type="submit" class="btn btn-primary"><i class="fa fa-key"></i> {{ button_login }}</button>]]></search>
        <add><![CDATA[{% if ps_google_recaptcha_status %}
            <button type="submit" class="btn btn-primary g-recaptcha"
            {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
            {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
            {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %}><i class="fa fa-key"></i> {{ button_login }}</button>
        {% else %}
            <button type="submit" class="btn btn-primary"><i class="fa fa-key"></i> {{ button_login }}</button>
        {% endif %}]]></add>
    </operation>
    </file>
    <!-- admin login end -->

    <!-- forgotten password start -->
    <file path="catalog/controller/account/forgotten.php">
        <operation>
            <search><![CDATA[protected function validate() {]]></search>
            <add position="after"><![CDATA[
		// Captcha
		if ($this->config->get('captcha_' . $this->config->get('config_captcha') . '_status') && in_array('forgotten_password', (array)$this->config->get('config_captcha_page'))) {
			$captcha = $this->load->controller('extension/captcha/' . $this->config->get('config_captcha') . '/validate');

			if ($captcha) {
				$this->error['captcha'] = $captcha;
			}
		}
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/account/forgotten.php">
        <operation>
            <search><![CDATA[if (isset($this->request->post['email'])) {]]></search>
            <add position="before"><![CDATA[
		// Captcha
		if ($this->config->get('captcha_' . $this->config->get('config_captcha') . '_status') && in_array('forgotten_password', (array)$this->config->get('config_captcha_page'))) {
			$data['captcha'] = $this->load->controller('extension/captcha/' . $this->config->get('config_captcha'), $this->error);
		} else {
			$data['captcha'] = '';
		}

        $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

        if ($data['ps_google_recaptcha_status']) {
            $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

            $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
            $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
            $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
            $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
            $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
        }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/account/forgotten.twig">
        <operation>
            <search><![CDATA[</fieldset>]]></search>
            <add position="after"><![CDATA[{{ captcha }}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/account/forgotten.twig">
        <operation>
            <search position="replace"><![CDATA[<input type="submit" value="{{ button_continue }}" class="btn btn-primary" />]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}
                <input type="submit" value="{{ button_continue }}" class="btn btn-primary g-recaptcha"
                {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
                {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
                {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %} />
            {% else %}
                <input type="submit" value="{{ button_continue }}" class="btn btn-primary" />
            {% endif %}
            ]]></add>
        </operation>
    </file>
    <!-- forgotten password end -->

    <!-- frontend login start -->
    <file path="catalog/controller/account/login.php">
        <operation>
            <search><![CDATA[protected function validate() {]]></search>
            <add position="after"><![CDATA[
		// Captcha
		if ($this->config->get('captcha_' . $this->config->get('config_captcha') . '_status') && in_array('catalog_login', (array)$this->config->get('config_captcha_page'))) {
			$captcha = $this->load->controller('extension/captcha/' . $this->config->get('config_captcha') . '/validate');

			if ($captcha) {
				$this->error['captcha'] = $captcha;
			}
		}
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/account/login.php">
        <operation>
            <search><![CDATA[if (isset($this->request->post['email'])) {]]></search>
            <add position="before"><![CDATA[
		// Captcha
		if ($this->config->get('captcha_' . $this->config->get('config_captcha') . '_status') && in_array('catalog_login', (array)$this->config->get('config_captcha_page'))) {
			$data['captcha'] = $this->load->controller('extension/captcha/' . $this->config->get('config_captcha'), $this->error);
		} else {
			$data['captcha'] = '';
		}

        $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

        if ($data['ps_google_recaptcha_status']) {
            $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

            $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
            $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
            $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
            $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
            $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
        }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/account/login.twig">
        <operation>
            <search position="replace"><![CDATA[<input type="submit" value="{{ button_login }}" class="btn btn-primary" />]]></search>
            <add><![CDATA[
            {{ captcha }}
            {% if ps_google_recaptcha_status %}
                <input type="submit" value="{{ button_login }}" class="btn btn-primary g-recaptcha"
                {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
                {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
                {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %} />
            {% else %}
                <input type="submit" value="{{ button_login }}" class="btn btn-primary" />
            {% endif %}
            ]]></add>
        </operation>
    </file>
    <!-- frontend login end -->

    <file path="admin/controller/setting/setting.php">
        <operation>
            <search><![CDATA[$data['captcha_pages'] = array();]]></search>
            <add position="after"><![CDATA[
        $this->load->language('extension/captcha/ps_google_recaptcha', 'ps_google_recaptcha');

        $ps_language = $this->language->get('ps_google_recaptcha');

		$data['captcha_pages'][] = array(
			'text'  => $ps_language->get('text_admin_login'),
			'value' => 'admin_login'
		);
		$data['captcha_pages'][] = array(
			'text'  => $ps_language->get('text_catalog_login'),
			'value' => 'catalog_login'
		);
		$data['captcha_pages'][] = array(
			'text'  => $ps_language->get('text_admin_forgotten_password'),
			'value' => 'admin_forgotten_password'
		);
		$data['captcha_pages'][] = array(
			'text'  => $ps_language->get('text_catalog_forgotten_password'),
			'value' => 'forgotten_password'
		);
            ]]></add>
        </operation>
    </file>

    <!-- frontend start -->
    <file path="catalog/controller/common/header.php">
        <operation>
            <search><![CDATA[$this->load->view('common/header', $data);]]></search>
            <add position="before"><![CDATA[
            $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

            if ($data['ps_google_recaptcha_status']) {
                $data['ps_hide_badge'] = $this->config->get('captcha_ps_google_recaptcha_hide_badge');
                $data['ps_css_nonce'] = $this->config->get('captcha_ps_google_recaptcha_css_nonce');
            }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/common/header.twig">
        <operation>
            <search><![CDATA[</head>]]></search>
            <add position="before"><![CDATA[{% if ps_google_recaptcha_status %}
            <style{% if ps_css_nonce %} nonce="{{ ps_css_nonce }}"{% endif %}>
            {% if ps_hide_badge %}
            .grecaptcha-badge { visibility: hidden; }
            .form-group .grecaptcha-badge { visibility: visible; }
            {% endif %}
            .pull-right > div:has(> iframe) {
                display: inline-block;
            }
            </style>
            <link rel="preconnect" href="https://www.google.com">
            <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
            {% endif %}]]></add>
        </operation>
    </file>
    <!-- frontend end -->

    <!-- captcha reset start -->
    <file path="catalog/controller/checkout/checkout.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('checkout/checkout', $data));]]></search>
            <add position="before"><![CDATA[$data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/checkout/checkout.twig">
        <operation>
            <search><![CDATA[$('#button-register').button('loading');]]></search>
            <add position="after"><![CDATA[{% if ps_google_recaptcha_status %}
            },
            complete: function() {
                var scripts = document.querySelectorAll('script[data-widget-id]');

                for (var i = 0; i < scripts.length; i++) {
                    var widgetId = scripts[i].getAttribute('data-widget-id'),
                    methodName = 'resetRecaptcha' + widgetId;
                    if (typeof window[methodName] === 'function') { window[methodName](); }
            }
            {% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/checkout/checkout.twig">
        <operation>
            <search><![CDATA[$('#button-guest').button('loading');]]></search>
            <add position="after"><![CDATA[{% if ps_google_recaptcha_status %}
            },
            complete: function() {
                var scripts = document.querySelectorAll('script[data-widget-id]');

                for (var i = 0; i < scripts.length; i++) {
                    var widgetId = scripts[i].getAttribute('data-widget-id'),
                    methodName = 'resetRecaptcha' + widgetId;
                    if (typeof window[methodName] === 'function') { window[methodName](); }
            }
            {% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/product/product.twig">
        <operation>
            <search><![CDATA[$('#button-review').button('reset');]]></search>
            <add position="after"><![CDATA[{% if ps_google_recaptcha_status %}
            var scripts = document.querySelectorAll('script[data-widget-id]');

            for (var i = 0; i < scripts.length; i++) {
                var widgetId = scripts[i].getAttribute('data-widget-id'),
                methodName = 'resetRecaptcha' + widgetId;
                if (typeof window[methodName] === 'function') { window[methodName](); }
            }
            {% endif %}]]></add>
        </operation>
    </file>
    <!-- captcha reset end -->

    <file path="catalog/controller/account/return.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('account/return_form', $data));]]></search>
            <add position="before"><![CDATA[
            $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

            if ($data['ps_google_recaptcha_status']) {
                $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

                $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
                $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
                $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
                $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
                $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
            }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/account/register.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('account/register', $data));]]></search>
            <add position="before"><![CDATA[
            $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

            if ($data['ps_google_recaptcha_status']) {
                $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

                $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
                $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
                $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
                $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
                $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
            }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/affiliate/register.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('affiliate/register', $data));]]></search>
            <add position="before"><![CDATA[
            $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

            if ($data['ps_google_recaptcha_status']) {
                $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

                $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
                $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
                $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
                $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
                $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
            }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/checkout/guest.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('checkout/guest', $data));]]></search>
            <add position="before"><![CDATA[
            $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

            if ($data['ps_google_recaptcha_status']) {
                $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

                $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
                $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
                $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
                $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
                $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
            }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/checkout/register.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('checkout/register', $data));]]></search>
            <add position="before"><![CDATA[
            $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

            if ($data['ps_google_recaptcha_status']) {
                $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

                $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
                $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
                $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
                $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
                $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
            }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/information/contact.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('information/contact', $data));]]></search>
            <add position="before"><![CDATA[
            $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

            if ($data['ps_google_recaptcha_status']) {
                $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

                $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
                $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
                $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
                $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
                $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
            }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/product/product.php">
        <operation>
            <search><![CDATA[$this->response->setOutput($this->load->view('product/product', $data));]]></search>
            <add position="before"><![CDATA[
            $data['ps_google_recaptcha_status'] = $this->config->get('captcha_ps_google_recaptcha_status');

            if ($data['ps_google_recaptcha_status']) {
                $data['ps_widget_counter'] = $this->session->data['ps_google_recaptcha_counter'];

                $data['ps_key_type'] = $this->config->get('captcha_ps_google_recaptcha_key_type');
                $data['ps_badge_theme'] = $this->config->get('captcha_ps_google_recaptcha_badge_theme');
                $data['ps_badge_size'] = $this->config->get('captcha_ps_google_recaptcha_badge_size');
                $data['ps_badge_position'] = $this->config->get('captcha_ps_google_recaptcha_badge_position');
                $data['ps_site_key'] = $this->config->get('captcha_ps_google_recaptcha_site_key');
            }
            ]]></add>
        </operation>
    </file>

    <!-- replace v3 and v2_invisible buttons -->
    <file path="catalog/view/theme/default/template/account/register.twig">
        <operation>
            <search position="replace"><![CDATA[<input type="submit" value="{{ button_continue }}" class="btn btn-primary" />]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}
                <input type="submit" value="{{ button_continue }}" class="btn btn-primary g-recaptcha"
                 {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
                 {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
                 {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %} />
            {% else %}
                <input type="submit" value="{{ button_continue }}" class="btn btn-primary" />
            {% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/account/return_form.twig">
        <operation>
            <search position="replace"><![CDATA[<input type="submit" value="{{ button_submit }}" class="btn btn-primary" />]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}
                <input type="submit" value="{{ button_submit }}" class="btn btn-primary g-recaptcha"
                {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
                {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
                {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %} />
            {% else %}
                <input type="submit" value="{{ button_submit }}" class="btn btn-primary" />
            {% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/account/register.twig">
        <operation>
            <search position="replace"><![CDATA[<input type="submit" value="{{ button_continue }}" class="btn btn-primary" />]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}
                <input type="submit" value="{{ button_continue }}" class="btn btn-primary g-recaptcha"
                {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
                {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
                {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %} />
            {% else %}
                <input type="submit" value="{{ button_continue }}" class="btn btn-primary" />
            {% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/affiliate/register.twig">
        <operation>
            <search position="replace"><![CDATA[<input type="submit" value="{{ button_continue }}" class="btn btn-primary" />]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}
                <input type="submit" value="{{ button_continue }}" class="btn btn-primary g-recaptcha"
                {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
                {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
                {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %} />
            {% else %}
                <input type="submit" value="{{ button_continue }}" class="btn btn-primary" />
            {% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/checkout/guest.twig">
        <operation>
            <search position="replace"><![CDATA[<input type="button" value="{{ button_continue }}" id="button-guest" data-loading-text="{{ text_loading }}" class="btn btn-primary" />]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}
                <input type="button" value="{{ button_continue }}" data-loading-text="{{ text_loading }}" class="btn btn-primary g-recaptcha"
                {% if ps_key_type == 'v2_checkbox' %}id="button-guest"{% else %}id="ps-button-guest"{% endif %}
                {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
                {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
                {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onGuestFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %} />
                {% if ps_key_type != 'v2_checkbox' %}<button id="button-guest" aria-hidden="true" style="display: none;"></button>{% endif %}
            {% else %}
                <input type="button" value="{{ button_continue }}" id="button-guest" data-loading-text="{{ text_loading }}" class="btn btn-primary" />
            {% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/checkout/checkout.twig">
        <operation>
            <search position="replace"><![CDATA[$('#button-guest').button]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}$('#ps-button-guest').button{% else %}$('#button-guest').button{% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/checkout/register.twig">
        <operation>
            <search position="replace"><![CDATA[<input type="button" value="{{ button_continue }}" id="button-register" data-loading-text="{{ text_loading }}" class="btn btn-primary" />]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}
                <input type="button" value="{{ button_continue }}" data-loading-text="{{ text_loading }}" class="btn btn-primary g-recaptcha"
                {% if ps_key_type == 'v2_checkbox' %}id="button-register"{% else %}id="ps-button-register"{% endif %}
                {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
                {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
                {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onRegisterFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %} />
                {% if ps_key_type != 'v2_checkbox' %}<button id="button-register" aria-hidden="true" style="display: none;"></button>{% endif %}
            {% else %}
                <input type="button" value="{{ button_continue }}" id="button-register" data-loading-text="{{ text_loading }}" class="btn btn-primary" />
            {% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/checkout/checkout.twig">
        <operation>
            <search position="replace"><![CDATA[$('#button-register').button]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}$('#ps-button-register').button{% else %}$('#button-register').button{% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/information/contact.twig">
        <operation>
            <search position="replace"><![CDATA[<input class="btn btn-primary" type="submit" value="{{ button_submit }}" />]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}
                <input type="submit" value="{{ button_submit }}" class="btn btn-primary g-recaptcha"
                {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
                {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
                {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %} />
            {% else %}
                <input class="btn btn-primary" type="submit" value="{{ button_submit }}" />
            {% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/product/product.twig">
        <operation>
            <search position="replace"><![CDATA[$('#button-review').on('click', function() {]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}
                {% if ps_key_type == 'v2_checkbox' %}
                    $('#button-review').on('click', function() {
                {% else %}
                    $('#form-review').on('submit', function(e) {
                    e.preventDefault();
                {% endif %}
            {% endif %}]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/product/product.twig">
        <operation>
            <search position="replace"><![CDATA[<button type="button" id="button-review" data-loading-text="{{ text_loading }}" class="btn btn-primary">]]></search>
            <add><![CDATA[{% if ps_google_recaptcha_status %}
                <button type="button" data-loading-text="{{ text_loading }}" class="btn btn-primary g-recaptcha" {% if ps_key_type == 'v2_checkbox' %}id="button-review"{% endif %}
                {% if ps_badge_position == 'inline' %} data-theme="{{ ps_badge_theme }}"{% endif %} data-badge="{{ ps_badge_position }}"
                {% if ps_key_type == 'v2_checkbox' or ps_key_type == 'v2_invisible' %} data-size="{{ ps_badge_size }}"{% endif %}
                {% if ps_key_type == 'v3' or ps_key_type == 'v2_invisible' %} data-sitekey="{{ ps_site_key }}" data-callback="onFormSubmit{{ ps_widget_counter }}" data-action="submit"{% endif %}>
            {% else %}
                <button type="button" id="button-review" data-loading-text="{{ text_loading }}" class="btn btn-primary">
            {% endif %}
            ]]></add>
        </operation>
    </file>
    <!-- replace v3 and v2_invisible buttons -->

</modification>
