<?xml version="1.0" encoding="utf-8"?>
<!--
This file is part of "Playful Sparkle - Google reCAPTCHA" project and subject to the terms
and conditions defined in file "LICENSE", which is part of this source
code package and also available on the project page: https://github.com/playfulsparkle/oc3_google_recaptcha.git
-->
<modification>
    <name>Playful Sparkle - Google reCAPTCHA</name>
    <code>ps_google_recaptcha</code>
    <version>1.0.0</version>
    <author>Playful Sparkle</author>
    <link>https://github.com/playfulsparkle/oc3_google_recaptcha.git</link>
    <!-- frontend start -->
    <file path="catalog/view/theme/default/template/common/header.twig">
        <operation>
            <search><![CDATA[</head>]]></search>
            <add position="before"><![CDATA[<link rel="preconnect" href="https://www.google.com">
            <link rel="preconnect" href="https://www.gstatic.com" crossorigin>]]></add>
        </operation>
    </file>
    <!-- frontend end -->
    <file path="catalog/view/theme/default/template/checkout/checkout.twig">
        <operation>
            <search><![CDATA[$('#button-register').button('loading');]]></search>
            <add position="after"><![CDATA[
        },
        complete: function() {
            var scripts = document.querySelectorAll('script[data-widget-id]');
            for (var i = 0; i < scripts.length; i++) {
                var script = scripts[i],
                widgetId = script.getAttribute('data-widget-id'),
                methodName = 'resetRecaptcha' + widgetId;

                if (typeof window[methodName] === 'function') {
                    window[methodName]();
                }
            }
            ]]></add>
        </operation>
    </file>
    <file path="catalog/view/theme/default/template/checkout/checkout.twig">
        <operation>
            <search><![CDATA[$('#button-guest').button('loading');]]></search>
            <add position="after"><![CDATA[
        },
        complete: function() {
            var scripts = document.querySelectorAll('script[data-widget-id]');
            for (var i = 0; i < scripts.length; i++) {
                var script = scripts[i],
                widgetId = script.getAttribute('data-widget-id'),
                methodName = 'resetRecaptcha' + widgetId;

                if (typeof window[methodName] === 'function') {
                    window[methodName]();
                }
            }
            ]]></add>
        </operation>
    </file>
    <file path="catalog/view/theme/default/template/product/product.twig">
        <operation>
            <search><![CDATA[$('#button-review').button('reset');]]></search>
            <add position="after"><![CDATA[
        document.querySelectorAll('script[data-widget-id]').forEach(script => {
            var widgetId = script.getAttribute('data-widget-id');
            var methodName = 'resetRecaptcha' + widgetId;

            if (typeof window[methodName] === 'function') {
                console.log(`Calling method: ${methodName}`);
                window[methodName]();
            } else {
                console.warn(`Method not found: ${methodName}`);
            }
        });
            ]]></add>
        </operation>
    </file>
</modification>
