{% if key_type == 'v2_checkbox' or badge_position == 'inline'  %}
	{% if not login_page %}
		<fieldset>
			<legend>{{ text_captcha }}</legend>
	{% endif %}
  <div class="form-group required">
		<label class="{% if not alternative_layout %}col-sm-2 {% endif %}control-label">{% if key_type == 'v2_checkbox' %}{{ entry_challange_captcha }}{% else %}{{ entry_score_based_captcha }}{% endif %}</label>
    {% if not alternative_layout %}<div class="col-sm-10">{% endif %}
{% endif %}
			{% if key_type == 'v2_checkbox' or badge_position == 'inline' %}<div id="{% if alternative_layout %}input-payment-captcha{% else %}g-recaptcha-{{ widget_counter }}{% endif %}" data-sitekey="{{ site_key }}"></div>{% endif %}
			<script{% if script_nonce %} nonce="{{ script_nonce }}"{% endif %} data-widget-id="{{ widget_counter }}">
				var repositionCaptchaBadge{{ widget_counter }} = function () {
					var oldBadge = document.querySelector('.form-group .grecaptcha-badge');
					if (oldBadge) { oldBadge.remove(); }
					var grecaptchaBadge = document.querySelector('.grecaptcha-badge');
					if (grecaptchaBadge) {
							var grecaptchaContainer = grecaptchaBadge.closest('div');
							var errorCaptcha = document.querySelector('#error-captcha');
							if (grecaptchaContainer && errorCaptcha) {
								errorCaptcha.parentNode.insertBefore(grecaptchaContainer, errorCaptcha);
							}
					}
				};

				var resetRecaptcha{{ widget_counter }} = function () {
					if (window.grecaptcha && typeof grecaptcha.reset === 'function') {
						if (typeof recaptcha_widget{{ widget_counter }} === 'number') {
							grecaptcha.reset(recaptcha_widget{{ widget_counter }});
						} else {
							grecaptcha.reset();
						}
						{% if badge_position == 'inline' %}repositionCaptchaBadge{{ widget_counter }}();{% endif %}
					}
				};
			{% if key_type == 'v3' or key_type == 'v2_invisible' %}
				var recaptcha_form{{ widget_counter }} = document.currentScript ? document.currentScript.closest('form') : null;

				var onFormSubmit{{ widget_counter }} = function (token) {
						if (recaptcha_form{{ widget_counter }}) {
								var submitEvent = new Event('submit', {bubbles: true, cancelable: true});
								if (recaptcha_form{{ widget_counter }}.dispatchEvent(submitEvent)) { recaptcha_form{{ widget_counter }}.submit(); }
						}
				}
				{% if alternative_layout %}
				var onGuestFormSubmit{{ widget_counter }} = function(token) {
					document.querySelector('#button-guest').click();
				}

				var onRegisterFormSubmit{{ widget_counter }} = function (token) {
					document.querySelector('#button-register').click();
				}
			{% endif %}
			{% elseif key_type == 'v2_checkbox' %}
				var recaptcha_widget{{ widget_counter }},
				recaptcha_widget_obj{{ widget_counter }} = {% if alternative_layout %}document.querySelector('#input-payment-captcha'){% else %}document.querySelector('#g-recaptcha-{{ widget_counter }}'){% endif %},
				recaptcha_form{{ widget_counter }} = document.currentScript ? document.currentScript.closest('form') : null;

				var onloadCallback{{ widget_counter }} = function () {
					recaptcha_widget{{ widget_counter }} = grecaptcha.render(recaptcha_widget_obj{{ widget_counter }}, {
						'sitekey': '{{ site_key }}',
						'theme': '{{ badge_theme }}',
						'size': '{{ badge_size }}'
					});
				};

				if (recaptcha_form{{ widget_counter }}) {
					recaptcha_form{{ widget_counter }}.addEventListener('submit', function () {
						setTimeout(resetRecaptcha{{ widget_counter }}, 1000);
					});
				}
			{% endif %}
			</script>
			{% if error_captcha %}<div id="error-captcha" class="text-danger">{{ error_captcha }}</div>{% else %}<div id="error-captcha"></div>{% endif %}
{% if key_type == 'v2_checkbox' or badge_position == 'inline'  %}
		{% if not alternative_layout %}</div>{% endif %}
	</div>
	{% if not login_page %}
		</fieldset>
	{% endif %}
{% endif %}
{% if hide_badge %}
<div class="form-group">
	<div class="col-sm-12">
		<p>{{ text_recaptcha_branding }}</p>
	</div>
</div>
{% endif %}
<script{% if google_captcha_nonce %} nonce="{{ google_captcha_nonce }}"{% endif %} src="{{ google_captcha_url }}" async defer></script>
